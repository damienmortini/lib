const a3_0x1533=['string','axiosException','toString','nxCloudVersion','RunEnd\x20duration','__awaiter','status','assign','next','Run\x20completion\x20responded\x20with\x20`undefined`.','throw','getRunGroup','startRun','/nx-cloud/runs/start','RunEnd.\x20Completed\x20tasks','machineInfo','../../../utilities/is-private-cloud','Invalid\x20Nx\x20Cloud\x20response:\x20','recordMetric','RunStart','runContext','axiosMultipleTries','RunStart\x20duration','VERBOSE_LOGGING','promisify','mapRespToPerfEntry','extractErrorMessage','application/octet-stream','response','/nx-cloud/runs/end','runUrl','parse','headers','createReqBody','api','printDuration','CloudRunApi','Invalid\x20end\x20run\x20response:\x20','stack','note','Stack\x20Trace:','../../../utilities/environment','slice','error','Run\x20Details:','messages','urls','post','message','endRun','Invalid\x20end\x20run\x20response','getCIExecutionEnv','nx-cloud','map','uploadedToStorage','__esModule','getCIExecutionId','apiAxiosInstance','RUNNER_FAILURE_PERF_ENTRY','unknown','zlib','devDependencies','length','apiError','util','stringify','data','terminalOutput','getBranch','...','value','createApiAxiosInstance','@nrwl/nx-cloud','gzip'];(function(_0x4150f0,_0x1533a3){const _0x3757fb=function(_0x167f94){while(--_0x167f94){_0x4150f0['push'](_0x4150f0['shift']());}};_0x3757fb(++_0x1533a3);}(a3_0x1533,0x75));const a3_0x3757=function(_0x4150f0,_0x1533a3){_0x4150f0=_0x4150f0-0x0;let _0x3757fb=a3_0x1533[_0x4150f0];return _0x3757fb;};'use strict';var __awaiter=this&&this[a3_0x3757('0x24')]||function(_0x7c8a52,_0x393f1b,_0x5a1fd2,_0x249da9){function _0x282f4d(_0x3a7953){return _0x3a7953 instanceof _0x5a1fd2?_0x3a7953:new _0x5a1fd2(function(_0x589381){_0x589381(_0x3a7953);});}return new(_0x5a1fd2||(_0x5a1fd2=Promise))(function(_0x44487e,_0x28d4e2){function _0x36f055(_0x476207){try{_0x55f52e(_0x249da9[a3_0x3757('0x27')](_0x476207));}catch(_0x8bb708){_0x28d4e2(_0x8bb708);}}function _0x4b9048(_0x31e270){try{_0x55f52e(_0x249da9[a3_0x3757('0x29')](_0x31e270));}catch(_0x1e82b2){_0x28d4e2(_0x1e82b2);}}function _0x55f52e(_0x5cd12e){_0x5cd12e['done']?_0x44487e(_0x5cd12e[a3_0x3757('0x1b')]):_0x282f4d(_0x5cd12e[a3_0x3757('0x1b')])['then'](_0x36f055,_0x4b9048);}_0x55f52e((_0x249da9=_0x249da9['apply'](_0x7c8a52,_0x393f1b||[]))[a3_0x3757('0x27')]());});};Object['defineProperty'](exports,a3_0x3757('0xc'),{'value':!![]});exports[a3_0x3757('0x43')]=void 0x0;const axios_1=require('../../../utilities/axios');const environment_1=require(a3_0x3757('0x48'));const fs_1=require('fs');const zlib_1=require(a3_0x3757('0x11'));const util_1=require(a3_0x3757('0x15'));const metric_logger_1=require('../../../utilities/metric-logger');const is_private_cloud_1=require(a3_0x3757('0x2f'));const {output}=require('../../../utilities/nx-imports');class CloudRunApi{constructor(_0x318863,_0x2483fc,_0x50c210,_0x56fa53){this[a3_0x3757('0x2')]=_0x318863;this['runContext']=_0x2483fc;this[a3_0x3757('0x2e')]=_0x56fa53;this[a3_0x3757('0xe')]=(0x0,axios_1[a3_0x3757('0x1c')])(_0x50c210);}['startRun'](_0xf9a0e3,_0x2539a6){var _0x11ecdd;return __awaiter(this,void 0x0,void 0x0,function*(){if(this[a3_0x3757('0x2')][a3_0x3757('0x14')])return{};const _0x25151f=(0x0,metric_logger_1['createMetricRecorder'])(a3_0x3757('0x2b'));try{const _0x484e63={'meta':{'nxCloudVersion':this[a3_0x3757('0x22')]()},'branch':(0x0,environment_1[a3_0x3757('0x19')])(),'runGroup':(0x0,environment_1[a3_0x3757('0x2a')])(),'ciExecutionId':(0x0,environment_1[a3_0x3757('0xd')])(),'ciExecutionEnv':(0x0,environment_1[a3_0x3757('0x8')])(),'distributedExecutionId':_0xf9a0e3,'hashes':_0x2539a6};if(environment_1['VERBOSE_LOGGING']){output['note']({'title':a3_0x3757('0x32'),'bodyLines':['\x0a'+JSON[a3_0x3757('0x16')](_0x484e63,null,0x2)]});}const _0x32444f=yield(0x0,axios_1['printDuration'])(a3_0x3757('0x35'),()=>(0x0,axios_1[a3_0x3757('0x34')])(()=>this[a3_0x3757('0xe')][a3_0x3757('0x4')](a3_0x3757('0x2c'),_0x484e63)));_0x25151f['recordMetric']((0x0,metric_logger_1[a3_0x3757('0x38')])(_0x32444f));if(_0x32444f[a3_0x3757('0x17')]&&_0x32444f['data']['message']){this['messages'][a3_0x3757('0x5')]=_0x32444f[a3_0x3757('0x17')][a3_0x3757('0x5')];}if(!_0x32444f[a3_0x3757('0x17')]||!_0x32444f['data']['urls']){this[a3_0x3757('0x2')][a3_0x3757('0x14')]=a3_0x3757('0x30')+JSON[a3_0x3757('0x16')](_0x32444f[a3_0x3757('0x17')]);return{};}return _0x32444f[a3_0x3757('0x17')][a3_0x3757('0x3')];}catch(_0x5c53bc){_0x25151f[a3_0x3757('0x31')](((_0x11ecdd=_0x5c53bc===null||_0x5c53bc===void 0x0?void 0x0:_0x5c53bc['axiosException'])===null||_0x11ecdd===void 0x0?void 0x0:_0x11ecdd['response'])?(0x0,metric_logger_1[a3_0x3757('0x38')])(_0x5c53bc['axiosException']['response']):metric_logger_1[a3_0x3757('0xf')]);this['messages'][a3_0x3757('0x14')]=this['messages'][a3_0x3757('0x39')](_0x5c53bc,a3_0x3757('0x41'));return{};}});}[a3_0x3757('0x40')](_0x65f761,_0x573e21,_0xa5ef6c,_0x1519ef){if((0x0,is_private_cloud_1['isConnectedToPrivateCloud'])()){for(let _0x10df1a of _0x573e21){delete _0x10df1a[a3_0x3757('0xb')];}}const _0x57e0cf=Object[a3_0x3757('0x26')](Object[a3_0x3757('0x26')]({'meta':{'nxCloudVersion':this['nxCloudVersion']()},'tasks':_0x573e21,'run':_0x65f761,'linkId':_0x1519ef},(0x0,is_private_cloud_1['isConnectedToPrivateCloud'])()?{}:_0xa5ef6c),{'machineInfo':this[a3_0x3757('0x2e')]});return JSON[a3_0x3757('0x16')](_0x57e0cf);}[a3_0x3757('0x6')](_0x1e6c06,_0x1acee4,_0x6332aa,_0x16f67){var _0x1b378f,_0x275cd2;return __awaiter(this,void 0x0,void 0x0,function*(){if(this[a3_0x3757('0x2')][a3_0x3757('0x14')])return![];let _0x169867=this[a3_0x3757('0x40')](_0x1e6c06,_0x1acee4,_0x6332aa,_0x16f67);if(_0x169867[a3_0x3757('0x13')]>0x14*0x3e8*0x3e8){_0x169867=this[a3_0x3757('0x40')](_0x1e6c06,_0x1acee4[a3_0x3757('0xa')](_0x1b33ef=>Object[a3_0x3757('0x26')](Object['assign']({},_0x1b33ef),{'hashDetails':undefined})),_0x6332aa,_0x16f67);}const _0xbef20e=Buffer['from'](_0x169867);const _0xbe0b3f=yield(0x0,util_1[a3_0x3757('0x37')])(zlib_1[a3_0x3757('0x1e')])(_0xbef20e);const _0xac7b31=(0x0,metric_logger_1['createMetricRecorder'])(a3_0x3757('0x6'));try{if(environment_1[a3_0x3757('0x36')]){const _0x8a1681=_0x1acee4[a3_0x3757('0xa')](_0x17d535=>{return Object[a3_0x3757('0x26')](Object[a3_0x3757('0x26')]({},_0x17d535),{'terminalOutput':_0x17d535[a3_0x3757('0x18')]?_0x17d535[a3_0x3757('0x18')][a3_0x3757('0x49')](0x0,0x14)+a3_0x3757('0x1a'):undefined});});output[a3_0x3757('0x46')]({'title':a3_0x3757('0x2d'),'bodyLines':['\x0a'+JSON[a3_0x3757('0x16')](_0x8a1681,null,0x2)]});}const _0x499009=yield(0x0,axios_1[a3_0x3757('0x42')])(a3_0x3757('0x23'),()=>(0x0,axios_1[a3_0x3757('0x34')])(()=>this[a3_0x3757('0xe')][a3_0x3757('0x4')](a3_0x3757('0x3c'),_0xbe0b3f,{'headers':Object[a3_0x3757('0x26')](Object[a3_0x3757('0x26')]({},this[a3_0x3757('0xe')]['defaults'][a3_0x3757('0x3f')]),{'Content-Encoding':a3_0x3757('0x1e'),'Content-Type':a3_0x3757('0x3a')})})));if(_0x499009){_0xac7b31[a3_0x3757('0x31')]((0x0,metric_logger_1[a3_0x3757('0x38')])(_0x499009));if(_0x499009['data']&&_0x499009[a3_0x3757('0x17')]['runUrl']&&_0x499009[a3_0x3757('0x17')][a3_0x3757('0x25')]==='success'){this[a3_0x3757('0x33')]['runUrl']=_0x499009['data'][a3_0x3757('0x3d')];return!![];}if(_0x499009[a3_0x3757('0x17')]&&_0x499009[a3_0x3757('0x17')][a3_0x3757('0x25')]){this[a3_0x3757('0x2')][a3_0x3757('0x14')]=a3_0x3757('0x44')+JSON['stringify'](_0x499009[a3_0x3757('0x17')][a3_0x3757('0x5')]);}else if(_0x499009[a3_0x3757('0x17')]&&typeof _0x499009['data']===a3_0x3757('0x1f')){if(_0x499009[a3_0x3757('0x17')]!=='success'){this['messages'][a3_0x3757('0x14')]=a3_0x3757('0x44')+JSON[a3_0x3757('0x16')](_0x499009[a3_0x3757('0x17')]);}}else{this['messages']['apiError']=a3_0x3757('0x44')+JSON[a3_0x3757('0x16')](_0x499009[a3_0x3757('0x17')]);}if(environment_1[a3_0x3757('0x36')]){output[a3_0x3757('0x46')]({'title':a3_0x3757('0x7'),'bodyLines':[JSON[a3_0x3757('0x16')](_0x499009[a3_0x3757('0x17')],null,0x2)]});}}else{output[a3_0x3757('0x0')]({'title':'Nx\x20Cloud:\x20Unknown\x20Error\x20Occurred','bodyLines':[a3_0x3757('0x28'),a3_0x3757('0x1'),JSON[a3_0x3757('0x16')](_0x1e6c06,null,0x2),a3_0x3757('0x47'),JSON['stringify'](new Error()[a3_0x3757('0x45')],null,0x2)]});}return![];}catch(_0x170a98){_0xac7b31['recordMetric'](((_0x1b378f=_0x170a98===null||_0x170a98===void 0x0?void 0x0:_0x170a98['axiosException'])===null||_0x1b378f===void 0x0?void 0x0:_0x1b378f[a3_0x3757('0x3b')])?(0x0,metric_logger_1[a3_0x3757('0x38')])(_0x170a98[a3_0x3757('0x20')][a3_0x3757('0x3b')]):metric_logger_1[a3_0x3757('0xf')]);const _0x4ada7b=(_0x275cd2=_0x170a98[a3_0x3757('0x20')])!==null&&_0x275cd2!==void 0x0?_0x275cd2:_0x170a98;this[a3_0x3757('0x2')][a3_0x3757('0x14')]=this[a3_0x3757('0x2')][a3_0x3757('0x39')](_0x4ada7b,'api');return![];}});}['nxCloudVersion'](){try{const _0x26651f=JSON[a3_0x3757('0x3e')]((0x0,fs_1['readFileSync'])('package.json')[a3_0x3757('0x21')]());return _0x26651f[a3_0x3757('0x12')][a3_0x3757('0x9')]||_0x26651f[a3_0x3757('0x12')][a3_0x3757('0x1d')];}catch(_0x50fa5d){return a3_0x3757('0x10');}}}exports[a3_0x3757('0x43')]=CloudRunApi;